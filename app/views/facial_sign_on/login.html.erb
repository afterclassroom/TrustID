<div class="row justify-content-center">
  <div class="col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h2 class="mb-4">Login bằng Axiam</h2>
        <%= form_with url: push_notification_facial_sign_on_index_path, method: :post, local: true, data: { turbo: false }, id: 'facial-sign-on-form' do |f| %>
          <div class="mb-3">
            <%= f.label :email, class: "form-label" %>
            <%= f.email_field :email, class: "form-control", required: true %>
          </div>
          <div class="d-grid gap-2">
            <%= f.submit "Gửi yêu cầu đăng nhập", class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('facial-sign-on-form');
  
  if (form) {
    form.addEventListener('submit', function(e) {
      const emailInput = this.querySelector('input[name="email"]');
      
      if (emailInput && emailInput.value) {
        // Pre-initialize AxiamActionCableClient trong background
        // Không cần await ở đây, để chạy background
        if (typeof window.initAxiamClientIfNeeded === 'function') {
          window.initAxiamClientIfNeeded().catch(error => {
            // Pre-init failed, continue anyway
          });
        }
      }
    });
  }
});
</script>
